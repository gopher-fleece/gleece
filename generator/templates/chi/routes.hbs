/*
--
This file is automatically generated. Any manual changes to this file may be overwritten.
It includes routes and handlers by the Gleece API Routes Generator.
--
Authors: Haim Kastner & Yuval Pomerchik
Generated by: Gleece Routes Generator
Generated Date: {{{GenerationDate}}}
--
Usage:
Refer to the Gleece documentation for details on how to use the generated routes and handlers.
--
Repository: https://github.com/gopher-fleece/gleece
--
*/

package {{{PackageName}}}

{{> Imports}}

// we have started!
var validatorInstance *validator.Validate
var urlParamRegex *regexp.Regexp

{{> TypeDeclarations}}

{{> FunctionDeclarations}}

func RegisterRoutes(engine *chi.Mux) {
	validatorInstance = validator.New()
	urlParamRegex = regexp.MustCompile(`\{([\w\d-_]+)\}`)

{{#each CustomValidators}}
	validatorInstance.RegisterValidation("{{{ValidateTagName}}}", func(fl validator.FieldLevel) bool {
		return CustomValidatorPkg{{@index}}.{{{FunctionName}}}(fl)
	})
{{/each}}

{{#each Controllers}}
	// {{{Name}}}
	{{#each Routes}}
		engine.{{{ToUpperCamel HttpVerb}}}(toChiUrl("{{{../RestMetadata.Path}}}{{{RestMetadata.Path}}}"), func(w http.ResponseWriter, ctx *http.Request) {
			authErr := {{> AuthorizationCall}}
			if authErr != nil {
				handleAuthorizationError(w, authErr, "{{{OperationId}}}")
				return
			}
			controller := {{{Name}}}Import.{{../Name}}{}
			controller.InitController(ctx)
			{{#ifAnyParamRequiresConversion FuncParams}}
			var conversionErr error
			{{/ifAnyParamRequiresConversion}}
			{{#each FuncParams}}
				{{> RequestArgsParsing}}
			{{/each}}

		{{> Middleware isErrorMiddleware=false middlewaresExecution="beforeOperation" }} 
		{{#equal HasReturnValue true}}value, {{/equal}}opError := controller.{{{OperationId}}}({{#each FuncParams}}{{#if TypeMeta.IsByAddress}}{{else}}*{{/if}}{{ToLowerCamel Name}}RawPtr{{#unless @last}}, {{/unless}}{{/each}})
		{{> ResponseHeaders }}

		{{> ReplyResponse}}
	})

	{{/each}}
{{/each}}
}