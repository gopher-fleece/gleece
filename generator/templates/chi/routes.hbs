/*
--
This file is automatically generated. Any manual changes to this file may be overwritten.
It includes routes and handlers by the Gleece API Routes Generator.
--
Authors: Haim Kastner & Yuval Pomerchik
Generated by: Gleece Routes Generator
{{{GenerationDate}}}
Target Engine: Chi v5 (https://github.com/go-chi/chi)
--
Usage:
Refer to the Gleece documentation https://docs.gleece.dev for details on how to use the generated routes and handlers.
--
Repository: https://github.com/gopher-fleece/gleece
--
*/

package {{{PackageName}}}

{{> Imports}}

var validatorInstance = validator.New()
var urlParamRegex *regexp.Regexp

{{> TypeDeclarations}}

{{> FunctionDeclarations}}

{{> RegisterMiddleware}}

func RegisterCustomValidator(validateTagName string, validateFunc runtime.ValidationFunc) {
	validatorInstance.RegisterValidation(validateTagName, func(fl validator.FieldLevel) bool {
		return validateFunc(fl)
	})
}

func RegisterRoutes(engine *chi.Mux) {
	urlParamRegex = regexp.MustCompile(`\{([\w\d-_]+)\}`)

    {{!-- An experimental feature to auto generate enums validators --}}
	{{#if ExperimentalConfig.GenerateEnumValidator}}
	{{#each Models.Enums}}
		registerEnumValidation(validatorInstance, "{{ToSnakeCase Name}}_enum", []string{ {{#each Values}}"{{{this}}}"{{#unless @last}},{{/unless}}{{/each}} })
	{{/each}}
	{{/if}}
	
	{{> RegisterRoutesExtension }}

{{#each Controllers}}
	// {{{Name}}}

	{{#each Routes}}
		engine.{{{ToUpperCamel HttpVerb}}}(toChiUrl("{{{../RestMetadata.Path}}}{{{RestMetadata.Path}}}"), func(w http.ResponseWriter, req *http.Request) {
			{{> RouteStartRoutesExtension }}
			
			authErr := {{> AuthorizationCall}}
			if authErr != nil {
				handleAuthorizationError(w, authErr, "{{{OperationId}}}")
				return
			}
			controller := {{{Name}}}.{{../Name}}{}
			controller.InitController(req)
			{{#ifAnyParamRequiresConversion FuncParams}}
			var conversionErr error
			{{/ifAnyParamRequiresConversion}}
			{{#each FuncParams}}
				{{> RequestArgsParsing}}
			{{/each}}

		{{> Middleware isErrorMiddleware=false middlewares="beforeOperationMiddlewares" }} 
		{{> BeforeOperationRoutesExtension }}
		{{#equal HasReturnValue true}}value, {{/equal}}opError := controller.{{{OperationId}}}({{#CollapseMultiline}}{{> MethodParameterList}}{{/CollapseMultiline}})
		
		{{> ResponseHeaders }}
		
		{{> ResponseHeadersExtension}}

		{{> ReplyResponse}}
	})

	{{/each}}
{{/each}}
}